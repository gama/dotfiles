set-window-option -g utf8 on
set-window-option -g mode-keys vi
set-option -sg assume-paste-time 0
set-option -g escape-time 0
set-option -g focus-events on
set-option -g update-environment -r

# replace the default C-b prefix with C-a
unbind-key C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
is_vim="echo '#{pane_title}' | grep -q '\\- VIM$'"
should_forward_movement="echo '#{pane_title}' | grep -iqE '•'"
bind-key -n C-h      if-shell "$is_vim" "send-keys C-h"  "select-pane -L" \; run-shell "sleep 0.05" \; if-shell "$should_forward_movement" "select-pane -L"
bind-key -n C-j      if-shell "$is_vim" "send-keys C-j"  "select-pane -D" \; run-shell "sleep 0.05" \; if-shell "$should_forward_movement" "select-pane -D"
bind-key -n C-k      if-shell "$is_vim" "send-keys C-k"  "select-pane -U" \; run-shell "sleep 0.05" \; if-shell "$should_forward_movement" "select-pane -U"
bind-key -n C-l      if-shell "$is_vim" "send-keys C-l"  "select-pane -R" \; run-shell "sleep 0.05" \; if-shell "$should_forward_movement" "select-pane -R"
bind-key -n C-\      if-shell "$is_vim" "send-keys C-\\" "select-pane -l"

bind-key -nr M-Up    resize-pane -U
bind-key -nr M-Down  resize-pane -D
bind-key -nr M-Left  resize-pane -L
bind-key -nr M-Right resize-pane -R

bind-key    e     send-prefix \; send-key e
bind-key    j     send-prefix \; send-key j
bind-key    k     send-prefix \; send-key k
bind-key    l     send-prefix \; send-key l
bind-key    h     send-prefix \; send-key h
bind-key    y     send-prefix \; send-key y
bind-key    n     send-prefix \; send-key n
bind-key    p     send-prefix \; send-key p
bind-key    o     send-prefix \; send-key o
bind-key    O     send-prefix \; send-key O
bind-key    J     send-prefix \; send-key J
bind-key    K     send-prefix \; send-key K
bind-key    /     send-prefix \; send-key /
bind-key    Space send-prefix \; send-key Space
bind-key    [     send-prefix \; send-key [
bind-key    ]     send-prefix \; send-key ]

bind-key    :       command-prompt
bind-key    r       new-window -c '#{pane_current_path}'
bind-key    \       split-window -h -c '#{pane_current_path}'
bind-key    -       split-window -v -c '#{pane_current_path}'
bind-key    =       next-layout
bind-key    H       previous-window
bind-key    L       next-window
bind-key    {       previous-window
bind-key    }       next-window
bind-key    1       select-window -t :1
bind-key    2       select-window -t :2
bind-key    3       select-window -t :3
bind-key    4       select-window -t :4
bind-key    5       select-window -t :5
bind-key    6       select-window -t :6
bind-key    7       select-window -t :7
bind-key    8       select-window -t :8
bind-key    9       select-window -t :9
bind-key    0       select-window -l
bind-key    H       select-pane -L
bind-key    J       select-pane -D
bind-key    K       select-pane -U
bind-key    L       select-pane -R
bind-key -r Up      resize-pane -U
bind-key -r Down    resize-pane -D
bind-key -r Left    resize-pane -L
bind-key -r Right   resize-pane -R
bind-key    PPage   copy-mode -u -e
bind-key    u       copy-mode -e
bind-key    i       paste-buffer
bind-key    C       clear-history
bind-key    d       display-message "${USER}@${HOST}:${PWD}   -   %b %d %Y, %H:%M"

bind-key -r -t vi-copy K       page-up
bind-key -r -t vi-copy J       page-down
bind-key -r -t vi-copy M-k     scroll-up
bind-key -r -t vi-copy M-j     scroll-down
bind-key -r -t vi-copy v       begin-selection
bind-key -r -t vi-copy y       copy-selection
bind-key -r -t vi-copy V       rectangle-toggle

set-option -g prefix C-a
set-option -g history-limit 100000
set-option -g xterm-keys on
set-option -g terminal-overrides "*88col*:colors=88,*256col*:colors=256,xterm*:XT"
set-option -g default-terminal "screen-256color"
set-option -g base-index 1
set-option -g status on
set-option -g status-left ''
# set-option -g status-right ''
set-option -g status-right "#[fg=colour248,bg=colour250]#[fg=colour236,bg=colour248] %Y-%m-%d %H:%M #[fg=colour236,bg=colour248,nobold,nounderscore,noitalics]#[fg=colour252,bg=colour236] #h "
set-option -g window-status-format ' #I:#T '
set-option -g window-status-current-format '#[fg=colour15,bg=colour250,nobold,nounderscore,noitalics]#[fg=default,bg=colour15] #I:#T #[fg=colour15,bg=colour250,nobold,nounderscore,noitalics]#[fg=default,bg=default]'
set-option -g message-bg colour233
set-option -g message-fg colour254
set-option -g visual-activity on
set-option -g set-titles on
set-option -g set-titles-string '[#I.#P] #W'
set-option -g display-time 2000
# set-option -g status-left-length 100
# set-option -g status-left-style default
# set-option -g status-position bottom


set-window-option -g monitor-activity off
set-window-option -g automatic-rename
# set-option -g mouse on
# set-window-option -g mode-bg colour230
# set-window-option -g mode-mouse on
# set-window-option -g mouse-select-pane on
# set-window-option -g mouse-select-window on

set-option -g window-style 'bg=colour254'
set-option -g window-active-style 'bg=colour15'
set-option -g pane-border-style 'fg=colour254,bg=colour254'
set-option -g pane-active-border-style 'fg=colour15,bg=colour15'
set-option -g status-style 'fg=colour232,bg=colour250'
set-option -g window-status-style 'fg=colour234,bg=colour250'
# set-option -g window-status-current-style 'fg=#0000a0,bg=#dfdfdf'

# fix ssh agent when tmux is detached
# setenv -g SSH_AUTH_SOCK $HOME/.ssh/auth_sock
